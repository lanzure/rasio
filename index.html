<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Kalkulator Rasio Fiber Optik</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column; /* Changed to column to stack main content and footer */
            justify-content: center;
            align-items: center; /* Center horizontally */
            min-height: 90vh;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            margin-bottom: 20px; /* Add some space before the footer */
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"],
        select {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .hint {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
            display: block;
        }
        .error {
            color: red;
            font-size: 0.9em;
            margin-top: 5px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            width: 100%;
            margin-top: 20px;
            box-sizing: border-box;
        }
        button:hover {
            background-color: #0056b3;
        }
        .bilhanet-calc {
            font-size: 0.9em;
            color: #888;
            margin-top: 10px;
            margin-bottom: 20px;
            text-align: right;
        }
        .result-section {
            margin-top: 30px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            overflow: hidden;
            display: none; /* Hidden by default until results are calculated */
        }
        .result-row {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            background-color: #e9ecef;
        }
        .result-row:last-child {
            border-bottom: none;
        }
        .result-label {
            flex: 1;
            font-weight: bold;
            color: #333;
        }
        .result-value {
            flex: 2;
            text-align: right;
            font-size: 1.2em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
        .result-value .value-text {
            margin-right: 10px;
        }
        .redaman-odp-value.terlalu-bagus {
            color: #ffa500; /* Orange */
        }
        .redaman-odp-value.optimal {
            color: #28a745; /* Green */
        }
        .redaman-odp-value.terlalu-besar {
            color: #dc3545; /* Red */
        }

        .sisa-laser-value {
            color: #28a745;
            background-color: #ffc107;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            box-sizing: border-box;
            border: 1px solid #e0a800;
        }
        .copy-button {
            background-color: #6c757d;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .copy-button:hover {
            background-color: #5a6268;
        }
        footer {
            text-align: center;
            margin-top: 20px;
            color: #555;
            font-size: 0.9em;
        }
        .social-icons {
            margin-top: 10px;
        }
        .social-icons a {
            color: #555;
            margin: 0 10px;
            font-size: 1.5em;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .social-icons a:hover {
            color: #007bff; /* Default hover color */
        }
        .social-icons a.fa-facebook:hover {
            color: #3b5998; /* Facebook blue */
        }
        .social-icons a.fa-instagram:hover {
            color: #C13584; /* Instagram purple/pink */
        }
        .social-icons a.fa-tiktok:hover {
            color: #000; /* TikTok black */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Aplikasi Kalkulator Rasio</h1>

        <form id="ratioForm">
            <div class="form-group">
                <label for="input_laser">Input Laser</label>
                <input type="text" id="input_laser" name="input_laser" placeholder="Power (dB)" value="" required>
                <span class="hint">Gunakan tanda titik untuk angka koma</span>
                <p class="error" id="errorMessage"></p>
            </div>

            <div class="form-group">
                <label for="persen_rasio">Persen Rasio</label>
                <span class="hint">Splitter Ratio</span>
                <select id="persen_rasio" name="persen_rasio">
                    <option value="0:0">0:0</option>
                    <option value="1:99" selected>1:99</option>
                    <option value="2:98">2:98</option>
                    <option value="3:97">3:97</option>
                    <option value="5:95">5:95</option>
                    <option value="10:90">10:90</option>
                    <option value="15:85">15:85</option>
                    <option value="20:80">20:80</option>
                    <option value="25:75">25:75</option>
                    <option value="30:70">30:70</option>
                    <option value="35:65">35:65</option>
                    <option value="40:60">40:60</option>
                    <option value="45:55">45:55</option>
                    <option value="50:50">50:50</option>
                </select>
            </div>

            <div class="form-group">
                <label for="varian_odp">Varian ODP</label>
                <span class="hint">Pasif Splitter</span>
                <select id="varian_odp" name="varian_odp">
                    <option value="1:2">1:2</option>
                    <option value="1:4">1:4</option>
                    <option value="1:8" selected>1:8</option>
                    <option value="1:16">1:16</option>
                    <option value="1:32">1:32</option>
                    <option value="1:64">1:64</option>
                    <option value="1:128">1:128</option>
                </select>
            </div>
            <div class="bilhanet-calc">
                Bilhanet Ratio Calc
            </div>

            <button type="submit">HITUNG</button>
        </form>

        <div class="result-section" id="resultSection">
            <div class="result-row">
                <div class="result-label">REDAMAN<br>ODP</div>
                <div class="result-value">
                    <span class="value-text redaman-odp-value" id="redamanOdpValue"></span>
                    <span class="redaman-odp-text" id="redamanOdpStatusText"></span>
                </div>
            </div>
            <div class="result-row">
                <div class="result-label">SISA LASER<br>(Persen Besar)</div>
                <div class="result-value">
                    <span class="value-text sisa-laser-value" id="sisaLaserValue"></span>
                    <button type="button" class="copy-button" onclick="copyToInput()">Tempel ke Input</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; <span id="currentYear"></span>. All Rights Reserved.</p>
        <div class="social-icons">
            <a href="https://www.facebook.com/HasbyZF" target="_blank" class="fab fa-facebook" aria-label="Facebook"></a>
            <a href="https://www.instagram.com/hasbyzf" target="_blank" class="fab fa-instagram" aria-label="Instagram"></a>
            <a href="https://www.tiktok.com/@kinghasby" target="_blank" class="fab fa-tiktok" aria-label="TikTok"></a>
        </div>
    </footer>

    <script>
        // Set current year for copyright
        document.getElementById('currentYear').innerText = new Date().getFullYear();

        // Loss values (JavaScript objects instead of PHP arrays)
        const persenRasioLossValues = {
            main_port: {
                '0:0': 0.0,
                '1:99': 0.24,
                '2:98': 0.35,
                '3:97': 0.45,
                '5:95': 0.65,
                '10:90': 1.15,
                '15:85': 1.55,
                '20:80': 2.05,
                '25:75': 2.55,
                '30:70': 3.05,
                '35:65': 3.45,
                '40:60': 3.95,
                '45:55': 4.45,
                '50:50': 4.85
            },
            tap_port: {
                '0:0': 0.0,
                '1:99': 20.0,
                '2:98': 17.0,
                '3:97': 15.2,
                '5:95': 13.0,
                '10:90': 10.0,
                '15:85': 8.2,
                '20:80': 7.0,
                '25:75': 6.0,
                '30:70': 5.2,
                '35:65': 4.6,
                '40:60': 4.0,
                '45:55': 3.5,
                '50:50': 3.0
            }
        };

        const varianOdpLossValues = {
            '1:2': 3.5,
            '1:4': 7.0,
            '1:8': 10.5,
            '1:16': 14.0,
            '1:32': 17.5,
            '1:64': 21.0,
            '1:128': 24.5
        };

        // Function to get loss value
        function getLossValue(ratio_key, port_type, loss_object) {
            return loss_object[port_type][ratio_key] !== undefined ? loss_object[port_type][ratio_key] : 0;
        }

        function getODPLossValue(ratio_key, loss_object) {
            return loss_object[ratio_key] !== undefined ? loss_object[ratio_key] : 0;
        }

        // Event listener for form submission
        document.getElementById('ratioForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            const inputLaserField = document.getElementById('input_laser');
            let inputLaser = inputLaserField.value.replace(',', '.'); // Replace comma with dot for decimal
            const persenRasio = document.getElementById('persen_rasio').value;
            const varianOdp = document.getElementById('varian_odp').value;
            const errorMessageElement = document.getElementById('errorMessage');
            const resultSection = document.getElementById('resultSection');

            // Reset error message and results display
            errorMessageElement.innerText = '';
            resultSection.style.display = 'none';
            document.getElementById('redamanOdpValue').className = 'value-text redaman-odp-value'; // Reset classes
            document.getElementById('redamanOdpStatusText').innerText = '';

            if (isNaN(parseFloat(inputLaser))) {
                errorMessageElement.innerText = "Input Laser harus berupa angka.";
                return;
            }

            inputLaser = parseFloat(inputLaser);

            // --- Calculation for "REDAMAN ODP" ---
            let lossPersenRasioTap = getLossValue(persenRasio, 'tap_port', persenRasioLossValues);
            let lossVarianOdp = getODPLossValue(varianOdp, varianOdpLossValues);

            let totalLossForRedamanOdpPath;
            if (persenRasio === '0:0') {
                // If no ratio splitter, the signal goes directly to ODP.
                totalLossForRedamanOdpPath = lossVarianOdp;
            } else {
                totalLossForRedamanOdpPath = lossPersenRasioTap + lossVarianOdp;
            }
            
            let redamanOdpOutputPower = inputLaser - totalLossForRedamanOdpPath;

            // Determine Redaman ODP status text and class
            const thresholdOptimalUpperLimit = -10.0;
            const thresholdOptimalLowerLimit = -16.0;

            let redamanOdpStatusText = '';
            let redamanOdpStatusClass = '';

            if (redamanOdpOutputPower > thresholdOptimalUpperLimit) {
                redamanOdpStatusText = ' (Power Laser Masih Terlalu Bagus)';
                redamanOdpStatusClass = 'terlalu-bagus';
            } else if (redamanOdpOutputPower >= thresholdOptimalLowerLimit && redamanOdpOutputPower <= thresholdOptimalUpperLimit) {
                redamanOdpStatusText = ' (Redaman Optimal)';
                redamanOdpStatusClass = 'optimal';
            } else {
                redamanOdpStatusText = ' (Redaman Terlalu Besar)';
                redamanOdpStatusClass = 'terlalu-besar';
            }

            // --- Calculation for "SISA LASER" ---
            let lossPersenRasioMain = getLossValue(persenRasio, 'main_port', persenRasioLossValues);
            let sisaLaserOutputPower = inputLaser - lossPersenRasioMain;

            // Display results
            document.getElementById('redamanOdpValue').innerText = redamanOdpOutputPower.toFixed(2) + ' dBm';
            document.getElementById('redamanOdpValue').classList.add(redamanOdpStatusClass);
            document.getElementById('redamanOdpStatusText').innerText = redamanOdpStatusText;
            
            document.getElementById('sisaLaserValue').innerText = sisaLaserOutputPower.toFixed(2);
            
            resultSection.style.display = 'block'; // Show the result section
        });

        // Function to copy Sisa Laser value to Input Laser field
        function copyToInput() {
            var sisaLaserValue = document.getElementById('sisaLaserValue').innerText;
            var inputLaserField = document.getElementById('input_laser');
            inputLaserField.value = sisaLaserValue.replace(',', '.'); // Ensure dot for decimal when pasting
        }
    </script>
</body>
</html>
